<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

	<changeSet author="davijo" id="assethist-01">
		<createTable tableName="assethistory">
			<column name="assethist_id" type="BIGINT">
				<constraints primaryKey="true" primaryKeyName="assethist_pk" />
			</column>
			<column name="assethist_asset_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
            <column name="assethist_guid" type="VARCHAR(36)"/>
            <column name="assethist_active" type="BOOLEAN"/>
			<column name="assethist_eventcode_id" type="INT">
				<constraints nullable="false" />
			</column>
            <column name="assethist_countryregistration" type="VARCHAR(3)" />
			<column name="assethist_dateofevent" type="TIMESTAMP WITH TIME ZONE" />
			<column name="assethist_licenceindicator" type="BOOLEAN" />
			<column name="assethist_registrationnumber" type="VARCHAR(14)" />
			<column name="assethist_externalmarking" type="VARCHAR(14)" />
			<column name="assethist_nameofasset" type="VARCHAR(40)" />
			<column name="assethist_portofregistration" type="VARCHAR(30)" />
			<column name="assethist_vmsindicator" type="BOOLEAN" />
			<column name="assethist_main_fishgear_id" type="INT" />
			<column name="assethist_sub_fishgear_id" type="INT" />
			<column name="assethist_loa" type="numeric(6, 2)" />
			<column name="assethist_lbp" type="numeric(6, 2)" />
			<column name="assethist_tonnagegt" type="numeric(8, 2)" />
			<column name="assethist_othertonnage" type="numeric(8, 2)" />
			<column name="assethist_gts" type="numeric(7, 2)" />
            <column name="assethist_tonnagegt_unit" type="varchar(10)" defaultValue="LONDON"/>
			<column name="assethist_powerofmainengine" type="numeric(8, 2)" />
			<column name="assethist_powerofauxengine" type="numeric(8, 2)" />
			<column name="assethist_segment" type="VARCHAR(20)" />
			<column name="assethist_countryofimpexp" type="VARCHAR(3)" />
			<column name="assethist_typeofexport" type="VARCHAR(2)" />
			<column name="assethist_publicaid" type="VARCHAR(2)" />
			<column name="assethist_dateadmindecision" type="VARCHAR(8)" />
			<column name="assethist_decisionadmin_seg" type="VARCHAR(20)" />
			<column name="assethist_nameassetagent" type="VARCHAR(100)" />
			<column name="assethist_addressassetagent" type="VARCHAR(100)" />
			<column name="assethist_indicatorowner" type="BOOLEAN" />
			<column name="assethist_nameowner" type="VARCHAR(100)" />
			<column name="assethist_addressowner" type="VARCHAR(100)" />
			<column name="assethist_updattim" type="TIMESTAMP WITH TIME ZONE" />
			<column name="assethist_upuser" type="VARCHAR(60)" />
            
            <!-- extra fields -->
            <column name="assethist_fishingtype" type="INT"/>
            <column name="assethist_contactnumber" type="VARCHAR(100)"/>
            <column name="assethist_notes" type="VARCHAR(2048)"/>
            <column name="assethist_licencetype" type="VARCHAR(25)"/>
            <column name="assethist_contactemail" type="VARCHAR(100)"/>
		</createTable>
        
        <createSequence sequenceName="assethist_id_seq" minValue="100"/>
        
        <addForeignKeyConstraint baseColumnNames="assethist_asset_id"
			baseTableName="assethistory" constraintName="assethist_asset_fk"
			referencedColumnNames="asset_id"
			referencedTableName="asset" />
        
		<rollback>
			<dropTable tableName="assethistory" cascadeConstraints="true"/>
		</rollback>
	</changeSet>
	
	<changeSet author="nhily" id="Remove old sequence">
		<dropSequence sequenceName="assethist_id_seq"/>
	</changeSet>
	<changeSet author="nhily" id="modify data type time without time zone">
		<modifyDataType
            columnName="assethist_updattim"
            newDataType="TIMESTAMP WITHOUT TIME ZONE"
            tableName="assethistory"/>
	</changeSet>
	
	<changeSet author="nhily" id="withoutTimeZone1">
		<modifyDataType
            columnName="assethist_dateofevent"
            newDataType="TIMESTAMP WITHOUT TIME ZONE"
            tableName="assethistory"/>
	</changeSet>

	<changeSet author="roblar" id="Add producer organisation column">
		<addColumn tableName="assethistory">
			<column name="assethist_assetpo_id" type="BIGINT"/>
		</addColumn>
		<rollback>
			<dropColumn columnName="assethist_assetpo_id" tableName="assethistory"/>
		</rollback>
	</changeSet>

	<changeSet author="roblar" id="Add foreign key to the assetpo table">
		<addForeignKeyConstraint baseColumnNames="assethist_assetpo_id"
			baseTableName="assethistory" constraintName="assethist_assetpo_fk"
			referencedColumnNames="assetpo_id"
			referencedTableName="assetpo" />
		<rollback>
			<dropForeignKeyConstraint baseTableName="assethistory" constraintName="assethist_assetpo_fk"/>
		</rollback>
	</changeSet>
	<changeSet author="osdjup" id="Add ircs, cfr, imo, mmsi to history">
		<addColumn tableName="assethistory">
			<column name="assethist_cfr" type="VARCHAR(12)" />
			<column name="assethist_ircs" type="VARCHAR(8)" />
			<column name="assethist_mmsi" type="VARCHAR(9)" />
			<column name="assethist_imo" type="VARCHAR(7)" />
		</addColumn>
	</changeSet>

	<changeSet author="thofan" id="Add iccat, uvi, gfcm to asset">
		<addColumn tableName="assethistory">
			<column name="assethist_iccat" type="VARCHAR(50)" />
			<column name="assethist_uvi" type="VARCHAR(50)" />
			<column name="assethist_gfcm" type="VARCHAR(50)" />
		</addColumn>
	</changeSet>
	
	<changeSet author="matbul" id="Add ers and ais indicator">
		<addColumn tableName="assethistory">
			<column name="assethist_ers_indicator" type="BOOLEAN" />
			<column name="assethist_ais_indicator" type="BOOLEAN" />
			<column name="assethist_vessel_type" type="VARCHAR(100)" />
			<column name="assethist_vessel_date_of_entry" type="TIMESTAMP" />
			<column name="assethist_ircs_indicator" type="VARCHAR(1)" />
			<column name="assethist_hull_material" type="VARCHAR(100)" />
			<column name="assethist_year_of_construction" type="VARCHAR(100)" />
			<column name="assethist_main_fishing_gear_code" type="VARCHAR(100)" />
			<column name="assethist_sub_fishing_gear_code" type="VARCHAR(100)" />
			<column name="assethist_place_of_construction" type="VARCHAR(100)" />
		</addColumn>
	</changeSet>

</databaseChangeLog>
