<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	
	<parent>
	    <groupId>eu.europa.ec.fisheries.uvms.asset</groupId>
	    <artifactId>asset</artifactId>
	    <version>6.8.12-SNAPSHOT</version>
	    <relativePath>../pom.xml</relativePath>
    </parent>

	<artifactId>liquibase</artifactId>
	<version>6.8.12-SNAPSHOT</version>
	<name>liquibase</name>
	<packaging>pom</packaging>

	<properties>
		<project.scm.id>github</project.scm.id>
	</properties>

	<profiles>
        <profile>
			<id>postgres</id>
			<activation>
				<activeByDefault>false</activeByDefault>
			</activation>
			<properties>
				<db.driver>org.postgresql.Driver</db.driver>
				<db.url>jdbc:postgresql://localhost:5432/db71u</db.url>
				<db.user>asset</db.user>
				<db.passwd>asset</db.passwd>
                <db.defaultSchema>asset</db.defaultSchema>
				<db.changeLogFile>changelog/db-changelog-master.xml</db.changeLogFile>
                <db.diffTypes>data</db.diffTypes>
				<db.outputFile>changelog/generatedChangelog.xml</db.outputFile>
				<driver.groupId>org.postgresql</driver.groupId>
				<driver.artifactId>postgresql</driver.artifactId>
				<driver.version>42.2.23</driver.version>
			</properties>
			<dependencies>
		        <dependency>
				  <groupId>${driver.groupId}</groupId>
				  <artifactId>${driver.artifactId}</artifactId>
				  <version>${driver.version}</version>
				</dependency>
			</dependencies>			
		</profile>
		<profile>
            <id>oracle</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
				  <db.url>jdbc:oracle:thin:@localhost:1521:db04t01</db.url>
				  <db.driver>oracle.jdbc.driver.OracleDriver</db.driver>
				  <db.user>uvms_asset</db.user>
				  <db.passwd>uvms_asset</db.passwd>
                <db.changeLogFile>changelog/db-changelog-master.xml</db.changeLogFile>
				<driver.groupId>com.oracle</driver.groupId>
				<driver.artifactId>ojdbc7</driver.artifactId>
				<driver.version>12.1.0.2.0</driver.version>
            </properties>
            <dependencies>
		        <dependency>
				  <groupId>${driver.groupId}</groupId>
				  <artifactId>${driver.artifactId}</artifactId>
				  <version>${driver.version}</version>
				</dependency>
			</dependencies>            
        </profile>
        <profile>
			<id>publish-sql</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.liquibase</groupId>
						<artifactId>liquibase-maven-plugin</artifactId>
						<version>4.4.2</version>
						<configuration>
							<url>${db.docker.url}</url>
							<migrationSqlOutputFile>${project.build.directory}/full-update.sql</migrationSqlOutputFile>
							<outputFileEncoding>UTF-8</outputFileEncoding>
							<promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
							<changeLogFile>${db.changeLogFile}</changeLogFile>
							<driver>${db.driver}</driver>
							<username>${db.user}</username>
							<password>${db.passwd}</password>
							<defaultSchemaName>${db.defaultSchema}</defaultSchemaName>
							<outputChangeLogFile>${db.outputFile}</outputChangeLogFile>
							<diffTypes>${db.diffTypes}</diffTypes>
						</configuration>
						<executions>
							<execution>
								<id>update-schema-sql</id>
								<phase>process-resources</phase>
								<goals>
									<goal>updateSQL</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>build-helper-maven-plugin</artifactId>
						<version>3.2.0</version>
						<executions>
							<execution>
								<id>attach-artifacts</id>
								<phase>process-test-resources</phase>
								<goals>
									<goal>attach-artifact</goal>
								</goals>
								<configuration>
									<artifacts>
										<artifact>
											<file>${project.build.directory}/full-update.sql</file>
											<type>sql</type>
										</artifact>
									</artifacts>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
			<properties>
				<db.docker.url>offline:postgresql?changeLogFile=target/databasechangelog.csv&amp;outputLiquibaseSql=true</db.docker.url>
			</properties>
		</profile>        
	</profiles>


	<build>
		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.liquibase</groupId>
					<artifactId>liquibase-maven-plugin</artifactId>
					<version>4.4.2</version>
				</plugin>
			</plugins>
		</pluginManagement>
		<plugins>
				<plugin>
					<artifactId>maven-assembly-plugin</artifactId>
					<version>3.3.0</version>
					<configuration>
						<descriptors>
							<descriptor>assembly.xml</descriptor>
						</descriptors>
						<finalName>${artifactId}</finalName>
						<appendAssemblyId>false</appendAssemblyId>

					</configuration>
					<executions>
						<execution>
							<phase>package</phase>
							<goals>
								<goal>single</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<artifactId>maven-jar-plugin</artifactId>
					<executions>
						<execution>
							<id>default-jar</id>
							<!-- put the default-jar in the none phase to skip it from being created -->
							<phase>none</phase>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-deploy-plugin</artifactId>
					<goals>
						<goal>deploy-file</goal>
					</goals>
					<configuration>
						<packaging>zip</packaging>
						<generatePom>true</generatePom>
						<artifactId>${project.artifactId}</artifactId>
						<groupId>${project.groupId}</groupId>
						<version>${project.version}</version>
						<file>target/liquibase.zip</file>
					</configuration>
				</plugin>




			<plugin>
				<artifactId>maven-enforcer-plugin</artifactId>
				<version>3.0.0</version>
				<executions>
					<execution>
						<id>enforce-jdk-bytecode-version</id>
						<goals>
							<goal>enforce</goal>
						</goals>
						<configuration>
							<rules>
								<enforceBytecodeVersion>
									<maxJdkVersion>1.8</maxJdkVersion>
								</enforceBytecodeVersion>
							</rules>
						</configuration>
					</execution>
					<execution>
						<id>enforce-maven-versions</id>
						<goals>
							<goal>enforce</goal>
						</goals>
						<configuration>
							<rules>
								<requireMavenVersion>
									<version>3.2.0</version>
								</requireMavenVersion>
							</rules>
						</configuration>
					</execution>
				</executions>
				<dependencies>
					<dependency>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>extra-enforcer-rules</artifactId>
						<version>1.3</version>
						<scope>compile</scope>
					</dependency>
				</dependencies>
			</plugin>







		</plugins>
	</build>
</project>